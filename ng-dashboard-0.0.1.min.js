(function(i){var r=i.module("ngDashboard",[]);r.factory("invokeIfDefined",function(){return function(r,e,t){if(i.isDefined(r[t])){e[t](r[t])}}})})(angular);(function(i,r){var e=i.module("ngDashboard");e.provider("widgetGroupLayout",[function(){var r={};this.registerLayoutManager=function(i,e){r[i]=e};this.$get=["$injector",function(e){i.forEach(r,function(i){if(i.initialize){e.invoke(i.initialize,i)}});return{handleLayout:function(i,e){var t=e.layout&&e.layout.type?e.layout.type:"flow";if(!r[t]){throw"No LayoutManager "+t+" registered"}r[t].layout(i,e)}}}]}]);e.directive("widgetGroup",["widgetGroupLayout",function(e){return{restrict:"E",scope:{groupData:"=groupData"},controller:["$scope","$http","crossfilterUtils",function(e,n,o){var a=[],s=false;this.registerWidgetInitializer=function(i){if(s){i(e.crossFilter,e.namedGroups,e.groupData.name)}else{a.push(i)}};function u(){s=true;for(var i in a){a[i](e.crossFilter,e.namedGroups,e.groupData.name,e.rawData)}a.length=0}if(i.isArray(e.groupData.data)){e.rawData=e.groupData.data;e.crossFilter=r(e.groupData.data);e.namedGroups=t(e.groupData.groups,e.crossFilter,o);u()}else if(i.isString(e.groupData.dataUrl)){n({method:"GET",url:e.groupData.dataUrl}).success(function(i){e.rawData=i;e.crossFilter=r(i);e.namedGroups=t(e.groupData.groups,e.crossFilter,o);u()}).error(function(i){throw i})}else{u()}}],link:function(i,r){r.addClass("widget-group");var t=i.$watch("groupData",function(i){if(i){e.handleLayout(r,i);t()}})},template:'<div class="widget-group-header">'+'<h3 ng-if="groupData.title">{{groupData.title}}</h3>'+'<filter filter-data="groupFilter" widget-group-name="groupData.name" ng-class="groupFilter.type" class="group-filter" crossfilter="crossFilter" ng-repeat="groupFilter in groupData.filters"></filter>'+"</div>"}}]);function t(r,e,t){if(r&&e){var n={};i.forEach(r,function(i,r){if(!i.dimension){throw"A dimension is required for named groups"}if(!i.group){throw"A group is required for named groups"}var o=t.dimensionFunction(i.dimension);var a=e.dimension(o);var s=t.groupFunctions(i.group);var u=a.group().reduce(s.add,s.remove,s.init);n[r]={dimension:a,group:u}});return n}}})(angular,crossfilter);(function(i){var r=i.module("ngDashboard");function e(i){this.widgetProviders=i}e.prototype.createWidget=function(i,r,e){if(!this.widgetProviders[r]){throw"No widget with "+r+" registered"}return this.widgetProviders[r].createWidget(i,e)};r.provider("widgetFactory",[function(){var r={};var t={};this.registerWidgetProvider=function(i,e){r[i]=e};this.registerChartMixin=function(i,r){t[i]=r};this.$get=["$injector",function(n){i.forEach(t,function(i){if(i.initialize){n.invoke(i.initialize,i)}});i.forEach(r,function(i){if(i.initialize){n.invoke(i.initialize,i,t)}});return new e(r)}]}]);r.directive("widget",["widgetFactory",function(i){return{restrict:"E",scope:{widgetData:"=widgetData"},require:"^widgetGroup",link:function(r,e,n,o){var a,s;e.addClass("widget");o.registerWidgetInitializer(function(n,o,u,c){if(!u){throw"widget-group name is required for charts"}var d=e.find("widget-body");a=t(d,i,{crossfilter:n,namedGroups:o,rawData:r.widgetData,data:c,widgetGroupName:u});if(r.widgetData.overlays){s=[];for(var f in r.widgetData.overlays){var g=t(d,i,{crossfilter:n,namedGroups:o,rawData:r.widgetData.overlays[f],widgetGroupName:u});s.push(g)}}})},templateUrl:"./template/widget.html"}}]);function t(i,r,e){return r.createWidget(i,e.rawData.type,e)}})(angular);(function(i){var r=i.module("ngDashboard");var e=/^([^\(]*)\(([^\)]*)\).*$/;r.factory("widgetExpressionParser",["$parse",function(i){return{parse:function(r){var t=e.exec(r);var n=t[1];var o=i(t[2]);return{functionName:n,parameters:o}},valueFunction:function(r,e){var t=i(r);var n=e?e:"d";function o(i){var r={};r[n]=i;var e=t(r);return e}return o}}}])})(angular);(function(i){var r=i.module("ngDashboard");r.provider("scaleParser",[function(){var r={};this.registerScaleProvider=function(i,e){r[i]=e};this.$get=["$injector",function(t){i.forEach(r,function(i){if(i.initialize){t.invoke(i.initialize,i)}});return new e(r)}]}]);function e(i){this.scaleProviders=i}e.prototype.parse=function(i){if(!this.scaleProviders[i.type]){throw"No scaleprovider "+i.type+" registered"}return this.scaleProviders[i.type].createScale(i.parameters)}})(angular);(function(i){var r=i.module("ngDashboard");r.provider("crossfilterUtils",[function(){var r={};this.addGroupFunctionProvider=function(i,e){r[i]=e};this.$get=["widgetExpressionParser","$injector",function(e,t){i.forEach(r,function(i){if(i.initialize){t.invoke(i.initialize,i)}});return{dimensionFunction:function(i){if(!i){throw"Expression is required to create crossfilter dimension"}return e.valueFunction(i)},groupFunctions:function(i){if(!i){throw"Expression is required to create crossfilter group"}if(!r[i.type]){throw"No groupfunction provider for "+i.type+" registered"}return r[i.type].buildGroup(i.parameters,i.debug)},getDistinctValuesFromDimension:function(i){if(!i){return[]}var r=i.group();var e=r.all();var t=[];if(e){for(var n in e){t.push(e[n].key)}}r.dispose();return t}}}]}])})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerWidgetProvider("barchart",new e)}]);function e(){}e.prototype.initialize=["baseChartMixin","coordinateGridMixin","marginMixin","stackMixin","invokeIfDefined","colorMixin",function(i,r,e,t,n,o){this.baseChartMixin=i;this.coordinateGridMixin=r;this.invokeIfDefined=n;this.marginMixin=e;this.stackMixin=t;this.colorMixin=o}];e.prototype.createWidget=function(i,r){var e=dc.barChart(i[0],r.widgetGroupName);var t=this.invokeIfDefined;var n=r.rawData;this.baseChartMixin.configureChart(e,r);this.stackMixin.configureChart(e,r);this.coordinateGridMixin.configureChart(e,r);this.marginMixin.configureChart(e,r);this.colorMixin.configureChart(e,r);t(n,e,"outerPadding");t(n,e,"gap");e.render();return e}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerWidgetProvider("boxPlot",new e)}]);function e(){}e.prototype.initialize=["baseChartMixin","coordinateGridMixin","marginMixin","colorMixin",function(i,r,e,t){this.baseChartMixin=i;this.coordinateGridMixin=r;this.marginMixin=e;this.colorMixin=t}];e.prototype.createWidget=function(i,r){var e=dc.boxPlot(i[0],r.widgetGroupName);this.baseChartMixin.configureChart(e,r);this.coordinateGridMixin.configureChart(e,r);this.marginMixin.configureChart(e,r);this.colorMixin.configureChart(e,r);e.render();return e}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerWidgetProvider("heatmap",new e)}]);function e(){}e.prototype.initialize=["baseChartMixin","coordinateGridMixin","marginMixin","colorMixin","invokeIfDefined",function(i,r,e,t,n){this.baseChartMixin=i;this.coordinateGridMixin=r;this.invokeIfDefined=n;this.marginMixin=e;this.colorMixin=t}];e.prototype.createWidget=function(i,r){var e=dc.heatMap(i[0],r.widgetGroupName);this.baseChartMixin.configureChart(e,r);this.coordinateGridMixin.configureChart(e,r);this.marginMixin.configureChart(e,r);this.colorMixin.configureChart(e,r);e.render();return e}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerWidgetProvider("linechart",new e)}]);function e(){}e.prototype.initialize=["baseChartMixin","coordinateGridMixin","marginMixin","stackMixin","invokeIfDefined","colorMixin",function(i,r,e,t,n,o){this.baseChartMixin=i;this.coordinateGridMixin=r;this.invokeIfDefined=n;this.marginMixin=e;this.stackMixin=t;this.colorMixin=o}];e.prototype.createWidget=function(i,r){var e=dc.lineChart(i[0],r.widgetGroupName);this.baseChartMixin.configureChart(e,r);this.stackMixin.configureChart(e,r);this.coordinateGridMixin.configureChart(e,r);this.marginMixin.configureChart(e,r);this.colorMixin.configureChart(e,r);this.invokeIfDefined(r.rawData,e,"renderArea");this.invokeIfDefined(r.rawData,e,"renderDataPoints");this.invokeIfDefined(r.rawData,e,"interpolate");e.render();return e}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerWidgetProvider("piechart",new e)}]);function e(){}e.prototype.initialize=["baseChartMixin","invokeIfDefined","colorMixin",function(i,r,e){this.baseChartMixin=i;this.invokeIfDefined=r;this.colorMixin=e}];e.prototype.createWidget=function(i,r){var e=dc.pieChart(i[0],r.widgetGroupName);var t=this.invokeIfDefined;var n=r.rawData;this.baseChartMixin.configureChart(e,r);this.colorMixin.configureChart(e,r);t(n,e,"slicesCap");t(n,e,"innerRadius");t(n,e,"radius");t(n,e,"cx");t(n,e,"cy");t(n,e,"minAngleForLabel");e.render();return e}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["scaleParserProvider",function(i){i.registerScaleProvider("linear",new e)}]);function e(){}e.prototype.initialize=["invokeIfDefined",function(i){this.invokeIfDefined=i}];e.prototype.createScale=function(i){var r=d3.scale.linear();var e=this.invokeIfDefined;if(i){e(i,r,"domain");e(i,r,"range");e(i,r,"rangeRound");e(i,r,"clamp");e(i,r,"ticks")}return r}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerChartMixin("baseChartMixin",new e)}]);function e(){}e.prototype.initialize=["invokeIfDefined","widgetExpressionParser","crossfilterUtils",function(i,r,e){this.invokeIfDefined=i;this.widgetExpressionParser=r;this.crossfilterUtils=e}];e.prototype.configureChart=function(i,r){var e=r.rawData;var t=this.invokeIfDefined;var n=this.buildDimension(r);var o=this.buildGroup(n,r);i.dimension(n);if(e.namedGroup&&e.namedGroup.name){i.group(o,e.namedGroup.name)}else if(e.group&&e.group.name){i.group(o,e.group.name)}else{i.group(o)}t(e,i,"width");t(e,i,"minWidth");t(e,i,"height");t(e,i,"minHeight");t(e,i,"transitionDuration");t(e,i,"renderLabel");t(e,i,"renderTitle");if(e.data){i.data(this.widgetExpressionParser.valueFunction(e.data,"group"))}if(e.keyAccessor){i.keyAccessor(this.widgetExpressionParser.valueFunction(e.keyAccessor))}if(e.valueAccessor){i.valueAccessor(this.widgetExpressionParser.valueFunction(e.valueAccessor))}if(e.titleAccessor){i.title(this.widgetExpressionParser.valueFunction(e.titleAccessor))}if(e.labelAccessor){i.label(this.widgetExpressionParser.valueFunction(e.labelAccessor))}this.setupLegend(i,e.legend)};e.prototype.setupLegend=function(i,r){if(!r){return}var e=this.invokeIfDefined;var t=dc.legend();e(r,t,"x");e(r,t,"y");e(r,t,"gap");e(r,t,"itemHeight");e(r,t,"horizontal");e(r,t,"legendWidth");e(r,t,"itemWidth");i.legend(t)};e.prototype.buildDimension=function(i){if(i.rawData.namedGroup){var r=i.rawData.namedGroup.group;if(!i.namedGroups||!i.namedGroups[r]){throw"No named group "+r+" defined"}return i.namedGroups[r].dimension}else{var e=i.crossfilter;var t=this.crossfilterUtils.dimensionFunction(i.rawData.dimension);return e.dimension(t)}};e.prototype.buildGroup=function(i,r){if(r.rawData.namedGroup){var e=r.rawData.namedGroup.group;if(!r.namedGroups||!r.namedGroups[e]){throw"No named group "+e+" defined"}return r.namedGroups[e].group}else{var t=this.crossfilterUtils.groupFunctions(r.rawData.group);return i.group().reduce(t.add,t.remove,t.init)}}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerChartMixin("colorMixin",new e)}]);function e(){}e.prototype.initialize=["invokeIfDefined","$parse","scaleParser",function(i,r,e){this.invokeIfDefined=i;this.$parse=r;this.scaleParser=e}];e.prototype.configureChart=function(i,r){var e=r.rawData;var n=this.invokeIfDefined;n(e,i,"colorDomain");n(e,i,"linearColors");n(e,i,"ordinalColors");if(e.colors){i.colors(this.scaleParser.parse(e.colors))}if(e.colorAccessor){i.colorAccessor(t(this.$parse(e.colorAccessor)))}if(e.calculateColorDomain){i.calculateColorDomain()}};function t(i){function r(r,e){return i({d:r,i:e})}return r}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerChartMixin("coordinateGridMixin",new e)}]);function e(){}e.prototype.initialize=["scaleParser","invokeIfDefined","unitsParser",function(i,r,e){this.scaleParser=i;this.invokeIfDefined=r;this.unitsParser=e}];e.prototype.configureChart=function(i,r){var e=this.invokeIfDefined;var t=r.rawData;if(t.x){i.x(this.scaleParser.parse(t.x))}e(t,i,"yAxisPadding");e(t,i,"yAxisLabel");e(t,i,"brushOn");e(t,i,"elasticX");e(t,i,"elasticY");e(t,i,"mouseZoomable");e(t,i,"renderHorizontalGridLines");e(t,i,"renderVerticalGridLines");if(t.xUnits){i.xUnits(this.unitsParser.parse(t.xUnits))}if(t.xAxis){this.configureAxis(i.xAxis(),t.xAxis)}if(t.yAxis){this.configureAxis(i.yAxis(),t.yAxis)}};e.prototype.configureAxis=function(i,r){var e=this.invokeIfDefined;e(r,i,"orient");e(r,i,"ticks");e(r,i,"tickValues");e(r,i,"tickSize");e(r,i,"innerTickSize");e(r,i,"outerTickSize");e(r,i,"tickPadding");if(r.tickFormat){i.tickFormat(d3.format(r.tickFormat))}}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetFactoryProvider",function(i){i.registerChartMixin("marginMixin",new e)}]);function e(){}e.prototype.initialize=["invokeIfDefined",function(i){this.invokeIfDefined=i}];e.prototype.configureChart=function(i,r){this.invokeIfDefined(r.rawData,i,"margins")}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["crossfilterUtilsProvider",function(i){i.addGroupFunctionProvider("array",new e)}]);function e(){}e.prototype.initialize=["$parse",function(i){this.$parse=i}];e.prototype.buildGroup=function(i){if(!i){throw"sum needs a groupParam"}return t(this.$parse(i.value))};function t(i){var r={init:function(){return[]},add:function(r,e){var t=i({v:e});r.push(t);return r},remove:function(r,e){var t=i({v:e});r.splice(r.indexOf(t),1);return r}};return r}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["crossfilterUtilsProvider",function(i){i.addGroupFunctionProvider("sum",new e)}]);function e(){}e.prototype.initialize=["$parse",function(i){this.$parse=i}];e.prototype.buildGroup=function(i){if(!i){throw"sum needs a groupParam"}return t(this.$parse(i.value))};function t(i){var r={init:function(){return 0},add:function(r,e){var t=i({v:e});return r+t},remove:function(r,e){var t=i({v:e});return r-t}};return r}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetGroupLayoutProvider",function(i){i.registerLayoutManager("flow",new t)}]);var e='<div class="widget-group-flow">'+'<widget widget-data="widget" ng-repeat="widget in groupData.widgets"></widget>'+"</div>";function t(){}t.prototype.initialize=["$compile","$rootScope",function(i,r){this.$compile=i;this.$rootScope=r}];t.prototype.layout=function(r,t){var n=i.element(e);r.append(n);var o=this.$rootScope.$new();o.groupData=t;this.$compile(n)(o)}})(angular);(function(i){var r=i.module("ngDashboard");r.config(["widgetGroupLayoutProvider",function(i){i.registerLayoutManager("grid",new t)}]);var e='<div class="widget-group-grid">'+'<div class="widget-group-row" ng-repeat="row in rows">'+'<div class="widget-group-column" ng-repeat="column in row.columns">'+'<widget widget-data="widget" ng-repeat="widget in column.widgets"></widget>'+"</div>"+"</div>"+"</div>";function t(){}t.prototype.initialize=["$compile","$rootScope",function(i,r){this.$compile=i;this.$rootScope=r}];t.prototype.layout=function(r,t){this.checkParameters(t.layout);var n=i.element(e);r.append(n);var o=this.$rootScope.$new();o.rows=this.buildGrid(t);this.$compile(n)(o)};t.prototype.checkParameters=function(i){if(!i){throw"No layoutparameters for gridLayout defined"}if(!i.columns){throw"Grid layout needs a columns parameter"}if(!i.rows){throw"Grid layout needs a rows parameter"}};t.prototype.buildGrid=function(r){if(!r){return}var e=[];for(var t=0;t<r.layout.rows;t++){var o={columns:[]};for(var a=0;a<r.layout.columns;a++){o.columns.push({widgets:[]})}e.push(o)}i.forEach(r.widgets,function(i){n(e,i);e[i.gridRow].columns[i.gridColumn].widgets.push(i)});return e};function n(r,e){if(!i.isDefined(e.gridRow)){throw"Widget "+e.name+" does not define the gridRow"}if(!i.isDefined(e.gridColumn)){throw"Widget "+e.name+" does not define the gridColumn"}if(r.length<=e.gridRow){throw"Widget "+e.name+" defines the gridRow "+e.gridRow+". But only "+r.length+" (zero based) rows are available"}if(r[e.gridRow].columns.length<=e.gridColumn){throw"Widget "+e.name+" defines the gridColumn "+e.gridColumn+". But only "+r[e.gridRow].columns.length+" (zero based) rows are available"}}})(angular);